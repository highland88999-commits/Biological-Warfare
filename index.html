<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.youtube.com/iframe_api"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <title>Artemis Prime</title>
    <style>
        :root { --blue: #00f2ff; --gold: #d4af37; --red: #ff2d55; }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-user-select:none; touch-action:none; }
        body { background:#000; overflow:hidden; font-family: sans-serif; }

        /* THE ORACLE WINDOW */
        #oracle {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 260px; height: 260px; border-radius: 50%;
            border: 4px solid var(--gold); box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
            z-index: 5; overflow: hidden; background: #000;
        }
        #bg-video { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 1s; }

        /* UI */
        #hud { position: fixed; top: 40px; width: 100%; text-align: center; color: var(--blue); font-weight: bold; font-size: 1.2rem; z-index: 100; text-shadow: 0 0 10px #000; }
        #cannon {
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 110px; height: 110px; border-radius: 50%; border: 4px solid var(--gold);
            z-index: 100; display: flex; align-items: center; justify-content: center;
            color: var(--gold); background: rgba(0,0,0,0.8); font-weight: bold;
        }

        /* CELLS */
        .cell { position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: #fff; z-index: 10; pointer-events: none; }
        .blue { border: 2px solid var(--blue); box-shadow: 0 0 10px var(--blue); }
        .red { border: 2px solid var(--red); box-shadow: 0 0 10px var(--red); }
    </style>
</head>
<body onclick="kickstart()">

<div id="hud">STABILITY: <span id="xp">0</span></div>

<div id="oracle">
    <video id="bg-video" loop muted playsinline><source src="https://xo6u0xsindhyafqf.public.blob.vercel-storage.com/nexus_render%20%2811%29.webm" type="video/webm"></video>
</div>

<div id="music-engine" style="position: absolute; top: -9999px;"></div>

<div id="cannon" onpointerdown="deploy(event)">DEPLOY</div>
<div id="arena"></div>

<script>
    let musicPlayer, musicReady = false, active = false, score = 0, entities = [];
    const ORACLE_R = 130; 

    function onYouTubeIframeAPIReady() {
        musicPlayer = new YT.Player('music-engine', {
            videoId: 'qwMz1wgXokk',
            playerVars: { 'controls': 0, 'loop': 1, 'playlist': 'qwMz1wgXokk', 'playsinline': 1 },
            events: { 'onReady': () => musicReady = true }
        });
    }

    function kickstart() {
        if(active) return;
        active = true;
        const v = document.getElementById('bg-video');
        v.play(); v.style.opacity = 1;
        if(musicReady) { musicPlayer.unMute(); musicPlayer.playVideo(); }
        spawnEnemy();
        loop();
    }

    function deploy(e) {
        e.stopPropagation();
        if(active) entities.push(new Cell('blue'));
    }

    class Cell {
        constructor(type) {
            this.type = type;
            this.hp = 100;
            this.born = Date.now();
            this.r = 16;
            this.x = type === 'blue' ? window.innerWidth/2 : Math.random()*window.innerWidth;
            this.y = type === 'blue' ? window.innerHeight-160 : -50;
            this.vx = (Math.random()-0.5)*6;
            this.vy = type === 'blue' ? -5 : 5;
            this.el = document.createElement('div');
            this.el.className = `cell ${type}`;
            this.el.style.width = this.el.style.height = '32px';
            document.getElementById('arena').appendChild(this.el);
        }

        update(others) {
            // Degenerate after 20s
            if ((Date.now() - this.born) > 20000) this.hp -= 0.6;

            // Oracle Bounce
            let dx = this.x - (window.innerWidth/2);
            let dy = this.y - (window.innerHeight/2);
            let dist = Math.hypot(dx, dy);
            if (dist < ORACLE_R + this.r) {
                let angle = Math.atan2(dy, dx);
                this.vx = Math.cos(angle) * 6;
                this.vy = Math.sin(angle) * 6;
                this.x = (window.innerWidth/2) + Math.cos(angle)*(ORACLE_R + this.r + 2);
                this.y = (window.innerHeight/2) + Math.sin(angle)*(ORACLE_R + this.r + 2);
            }

            // Simple Homing
            let target = others.find(o => o.type !== this.type);
            if(target) {
                this.vx += (target.x - this.x) * 0.01;
                this.vy += (target.y - this.y) * 0.01;
            }

            this.x += this.vx; this.y += this.vy;
            if(this.x < 0 || this.x > window.innerWidth) this.vx *= -1;
            this.el.style.transform = `translate(${this.x-16}px,${this.y-16}px)`;
            this.el.innerText = Math.ceil(this.hp);
        }
    }

    function spawnEnemy() {
        if(active) { entities.push(new Cell('red')); setTimeout(spawnEnemy, 2500); }
    }

    function loop() {
        for(let i=entities.length-1; i>=0; i--) {
            let c = entities[i];
            c.update(entities);
            
            entities.forEach(other => {
                if(c.type !== other.type && Math.hypot(c.x-other.x, c.y-other.y) < 32) {
                    c.hp -= 2;
                }
            });

            if(c.hp <= 0 || c.y > window.innerHeight + 100 || c.y < -200) {
                if(c.hp <= 0 && c.type === 'red') score += 10;
                c.el.remove(); entities.splice(i, 1);
            }
        }
        document.getElementById('xp').innerText = score;
        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
