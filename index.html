<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Artemis ‚Ä¢ Prime Symbiote</title>
    <style>
        :root {
            --cyan: #00f2ff;
            --gold: #d4af37;
            --virus-red: #ff2d55;
            --disease-green: #00ff9d;
            --portal-purple: #bc13fe;
            --glass: rgba(8, 8, 25, 0.75);
            --glow-c: 0 0 40px rgba(0, 242, 255, 0.7);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { 
            width:100%; height:100%; overflow:hidden; 
            background:#000; font-family: 'Courier New', monospace; 
            color:var(--cyan); touch-action: none; 
        }

        #landing-overlay {
            position: fixed; inset: 0; z-index: 2000;
            background: #000;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
            color: var(--cyan);
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 1.2s ease-out;
        }
        #landing-text { 
            text-shadow: 0 0 30px var(--cyan); 
            animation: pulseText 3s infinite alternate; 
            z-index: 2;
        }
        @keyframes pulseText { 0% { opacity: 0.7; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1.05); } }

        #rain-canvas {
            position: fixed; inset: 0; z-index: 1;
            opacity: 0.35;
        }

        #start-overlay, #countdown-overlay, #transition-overlay, #revive-overlay, #win-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: radial-gradient(circle, #1a0033 0%, #000 90%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: auto;
        }
        #start-overlay { display: none; text-align: center; padding: 20px; }
        #countdown-overlay { display: none; }
        #transition-overlay { display: none; }
        #revive-overlay { display: none; }
        #win-overlay { display: none; }

        #disclaimer { 
            max-width: 90%; 
            background: rgba(255,0,0,0.15); 
            border: 2px solid var(--gold); 
            padding: 15px; 
            border-radius: 12px; 
            margin: 20px auto; 
            font-size: 0.95rem; 
            color: #ffcc00; 
        }
        .btn { 
            width: 220px; height: 80px; margin: 20px;
            background: linear-gradient(to top, #0a0a1f, #111);
            border-radius: 40px; border: 4px solid var(--gold);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: var(--gold); cursor: pointer; transition: 0.2s;
        }
        .btn:active { transform: scale(0.95); }

        .spinner { width: 50px; height: 50px; border: 5px solid var(--cyan); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #countdown-text { font-size: 6rem; color: var(--gold); margin: 20px; font-weight: bold; }

        #bg-video { 
            width: 100%; height: 100%; object-fit: cover; 
            filter: brightness(0.10) contrast(1.15) saturate(0.8); 
        }

        #cannon { 
            position: fixed; bottom: -10px; left: 50%; transform: translateX(-50%); 
            width: 140px; height: 120px; z-index: 300; pointer-events: none; 
            background: linear-gradient(to top, #0a0a1f, #111); 
            border-radius: 70px 70px 0 0; border: 4px solid var(--gold); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.1rem; color: var(--gold); 
            transition: transform 0.1s, box-shadow 0.1s; 
            box-shadow: 0 0 20px var(--gold);
        }
        #cannon.active { pointer-events: auto; }
        #cannon:active, #cannon.pressed { transform: translateX(-50%) scale(0.92); box-shadow: 0 0 60px var(--gold); }

        /* Keep your cell-orb, hud-box, etc. styles here */
        .cell-orb { 
            position: absolute; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #fff; font-size: 0.6rem; font-weight: bold;
            backdrop-filter: blur(4px); z-index: 160; 
            animation: cellPulse 4s infinite alternate ease-in-out;
        }
        @keyframes cellPulse { 0% { transform: scale(1); } 100% { transform: scale(1.08); } }

        .cell-good { background: radial-gradient(circle, #00f2ff88, #001122); border: 2px solid var(--cyan); }
        .cell-virus { background: radial-gradient(circle, #ff2d5588, #220000); border: 2px solid var(--virus-red); animation: virusWobble 3s infinite; }
        @keyframes virusWobble { 0%,100% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(8deg) scale(1.05); } }

        .cell-disease { background: radial-gradient(circle, #00ff9d88, #002211); border: 2px solid var(--disease-green); animation: diseaseWave 6s infinite; }
        @keyframes diseaseWave { 0%,100% { filter: hue-rotate(0deg); } 50% { filter: hue-rotate(30deg); } }

        .hp-bar { position: absolute; bottom: 4px; width: 25px; height: 3px; background: #111; border-radius: 2px; overflow: hidden; }
        .hp-fill { height: 100%; background: #0f0; width: 100%; }

        #ui-layer { position: fixed; inset: 0; z-index: 400; pointer-events: none; padding: 20px; color: var(--cyan); }
        .hud-box { background: var(--glass); border: 1px solid var(--cyan); padding: 12px; border-radius: 8px; backdrop-filter: blur(8px); pointer-events: auto; display: flex; flex-wrap: wrap; gap: 12px; align-items: center; font-size: 0.95rem; }
        #music-toggle, #pause-toggle, #boost-btn { cursor: pointer; padding: 6px 14px; background: rgba(0,242,255,0.1); border: 1px solid var(--cyan); border-radius: 6px; }
        #boost-btn.active { background: var(--cyan); color: #000; font-weight: bold; }
    </style>
</head>
<body>

    <div id="landing-overlay">
        <canvas id="rain-canvas"></canvas>
        <div id="landing-text">CLICK ANYWHERE TO BEGIN</div>
    </div>

    <div id="start-overlay">
        <h2 style="color:var(--gold); margin-bottom: 20px; font-size: 2rem;">Artemis ‚Ä¢ Prime Symbiote</h2>
        
        <div id="disclaimer">
            <strong>Heads up:</strong> This game is completely free, but hoodies and ongoing development are funded through player support and future features.<br>
            By playing, you're part of the journey to make real hoodies possible!<br>
            No purchases needed ‚Äî enjoy the grind! üöÄ
        </div>

        <div class="spinner" style="margin: 30px 0;"></div>
        <div class="btn" id="start-btn">‚ö° ENTER THE RIFT</div>
    </div>

    <div id="countdown-overlay">
        <h2 style="color:var(--gold); margin-bottom: 20px;">PREPARING RIFT...</h2>
        <div id="countdown-text">10</div>
        <div class="spinner"></div>
    </div>

    <!-- Add your transition-overlay, revive-overlay, win-overlay here with display:none; as needed -->

    <div id="rift-portal"></div>
    <div id="engine-bg">
        <video id="bg-video" autoplay loop muted playsinline src="https://xo6u0xsindhyafqf.public.blob.vercel-storage.com/nexus_render%20%2811%29.webm"></video>
    </div>

    <div id="ytplayer"></div>

    <div id="oracle-nucleus"><video id="oracle-video" autoplay loop muted playsinline src="https://files.catbox.moe/no2e76.mp4"></video></div>
    <div id="orbital-canvas"></div>
    
    <div id="ui-layer">
        <div class="hud-box">
            LVL <span id="level">1</span>  ‚Ä¢  SCORE <span id="score">0</span>/1000
            <span id="music-toggle">[Music: OFF]</span>
            <span id="pause-toggle">[PAUSE]</span>
            <span id="boost-btn">BOOST: x2 (30s)</span>
        </div>
    </div>

    <div id="cannon">‚ö° DEPLOY</div>

    <script>
        // DIGITAL RAIN ON LANDING ONLY
        const rainCanvas = document.getElementById('rain-canvas');
        const rainCtx = rainCanvas.getContext('2d');

        function resizeRainCanvas() {
            rainCanvas.width = window.innerWidth;
            rainCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeRainCanvas);
        resizeRainCanvas();

        const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()_+-=[]{}|;:,.<>?/'.split('');
        const fontSize = 14;
        const columns = rainCanvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawRain() {
            rainCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            rainCtx.fillRect(0, 0, rainCanvas.width, rainCanvas.height);

            rainCtx.fillStyle = '#00eaff';
            rainCtx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                const x = i * fontSize;
                const y = drops[i] * fontSize;

                rainCtx.fillText(text, x, y);

                if (y > rainCanvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        const rainInterval = setInterval(drawRain, 50);

        // LANDING CLICK - HIDE LANDING, SHOW DISCLAIMER
        const landing = document.getElementById('landing-overlay');
        const startOverlay = document.getElementById('start-overlay');

        landing.addEventListener('click', () => {
            landing.style.opacity = '0';
            setTimeout(() => {
                landing.style.display = 'none';
                clearInterval(rainInterval);
                rainCanvas.remove(); // fully remove canvas to stop any residual draw
                startOverlay.style.display = 'flex';
            }, 1200); // fade time
        }, { once: true }); // prevent multiple triggers

        // === GAME LOGIC ===
        const canvas = document.getElementById('orbital-canvas');
        const countdownOverlay = document.getElementById('countdown-overlay');
        const cannon = document.getElementById('cannon');

        let cells = [], enemies = [];
        let score = 0, level = 1, isWarping = false, isPaused = false, gameActive = false;
        const MARGIN = 4;
        let musicStarted = false;
        let musicMuted = true;
        let player;
        let boostMultiplier = 1;
        let boostTimer = null;

        cannon.addEventListener('pointerdown', () => {
            if (gameActive) {
                cannon.classList.add('pressed');
                fireCannon();
            }
        });
        cannon.addEventListener('pointerup pointercancel', () => cannon.classList.remove('pressed'));

        function spawnStarterCells() {
            for (let i = 0; i < 10; i++) {
                const offsetX = (Math.random() - 0.5) * 400;
                const offsetY = Math.random() * 100;
                cells.push(new Entity(
                    window.innerWidth / 2 + offsetX,
                    window.innerHeight - 150 - offsetY,
                    'cell'
                ));
            }
        }

        function startCountdown() {
            startOverlay.style.display = 'none';
            countdownOverlay.style.display = 'flex';
            cannon.classList.remove('active');
            let timeLeft = 10;
            document.getElementById('countdown-text').textContent = timeLeft;

            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('countdown-text').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    countdownOverlay.style.display = 'none';
                    gameActive = true;
                    cannon.classList.add('active');
                    spawnStarterCells();
                    spawnTick();
                }
            }, 1000);
        }

        document.getElementById('start-btn').addEventListener('click', startCountdown);

        // ... rest of your game code: Entity class, fireCannon, spawnTick, gameLoop, music, etc. ...
        // Paste the remaining functions from your previous working version here (loadProgress, saveProgress, nextLevel, checkFieldClear, boost logic, revive logic, YouTube setup, gameLoop, etc.)
    </script>
</body>
</html>
