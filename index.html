<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://quge5.com/88/tag.min.js" data-zone="206119" async data-cfasync="false"></script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Artemis • Prime Symbiote</title>
    <style>
        :root {
            --cyan: #00f2ff;
            --gold: #d4af37;
            --virus-red: #ff2d55;
            --disease-green: #00ff9d;
            --portal-purple: #bc13fe;
            --glass: rgba(8, 8, 25, 0.75);
            --glow-c: 0 0 40px rgba(0, 242, 255, 0.7);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { 
            width:100%; height:100%; overflow:hidden; 
            background:#000; font-family: 'Courier New', monospace; 
            color:var(--cyan); touch-action: none; 
        }

        #transition-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: radial-gradient(circle, #1a0033 0%, #000 90%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 1s;
        }
        #transition-overlay.active { opacity: 1; pointer-events: auto; }

        #rift-portal {
            position: fixed; top: -30px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 120px; z-index: 10;
            background: radial-gradient(ellipse at center, var(--portal-purple) 0%, transparent 80%);
            filter: blur(15px); animation: portalPulse 2s infinite;
        }

        @keyframes portalPulse { 0%,100% {opacity:0.6;} 50% {opacity:1; transform: translateX(-50%) scale(1.1);} }

        #engine-bg { position: fixed; inset: 0; z-index: 1; }
        #bg-video { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.12) contrast(1.1); }

        #music-player {
            position: absolute; width:1px; height:1px; left:-999px; top:-999px;
        }

        #oracle-nucleus { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: min(260px, 50vw); height: min(260px, 50vw); 
            border-radius: 50%; border: 4px solid var(--gold); 
            box-shadow: var(--glow-c); z-index: 100; overflow: hidden; background: #000;
        }
        #oracle-video { width: 100%; height: 100%; object-fit: cover; }

        #orbital-canvas { position: fixed; inset: 0; z-index: 150; pointer-events: none; }

        .cell-orb { 
            position: absolute; width: 44px; height: 44px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #fff; font-size: 0.6rem; font-weight: bold;
            backdrop-filter: blur(4px); z-index: 160; 
        }
        
        .hp-bar { position: absolute; bottom: 4px; width: 25px; height: 3px; background: #111; border-radius: 2px; overflow: hidden; }
        .hp-fill { height: 100%; background: #0f0; width: 100%; }

        .cell-good { background: radial-gradient(circle, #00f2ff66, #001122); border: 2px solid var(--cyan); }
        .cell-virus { background: radial-gradient(circle, #ff2d5566, #220000); border: 2px solid var(--virus-red); }
        .cell-disease { background: radial-gradient(circle, #00ff9d66, #002211); border: 2px solid var(--disease-green); }

        #cannon { 
            position: fixed; bottom: -10px; left: 50%; transform: translateX(-50%); 
            width: 140px; height: 120px; z-index: 300; pointer-events: auto; 
            background: linear-gradient(to top, #0a0a1f, #111); 
            border-radius: 70px 70px 0 0; border: 4px solid var(--gold); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.1rem; color: var(--gold); cursor: pointer; transition: 0.2s;
        }
        #cannon:active { transform: translateX(-50%) scale(0.95); }

        #ui-layer { position: fixed; inset: 0; z-index: 400; pointer-events: none; padding: 20px; color: var(--cyan); }
        .hud-box { background: var(--glass); border: 1px solid var(--cyan); padding: 10px; border-radius: 8px; backdrop-filter: blur(8px); pointer-events: auto; }
        #music-toggle { font-size: 0.8rem; margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="transition-overlay">
        <h2 id="trans-text" style="color:var(--gold); margin-bottom: 20px;">WARPING TO LEVEL 2</h2>
        <div style="width: 50px; height: 50px; border: 5px solid var(--cyan); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    </div>

    <div id="rift-portal"></div>
    <div id="engine-bg">
        <video id="bg-video" autoplay loop muted playsinline src="https://files.catbox.moe/b0261q.webm"></video>
    </div>

    <!-- Hidden YouTube player for audio (Venom loop) -->
    <div id="music-player">
        <iframe 
            id="yt-audio" 
            width="1" height="1" 
            src="https://www.youtube.com/embed/qwMz1wgXokk?enablejsapi=1&autoplay=0&loop=1&playlist=qwMz1wgXokk&mute=1" 
            frameborder="0" 
            allow="autoplay; encrypted-media" 
            allowfullscreen>
        </iframe>
    </div>

    <div id="oracle-nucleus"><video id="oracle-video" autoplay loop muted playsinline src="https://files.catbox.moe/no2e76.mp4"></video></div>
    <div id="orbital-canvas"></div>
    
    <div id="ui-layer">
        <div class="hud-box" style="width: fit-content;">
            LVL: <span id="level">1</span> | SCORE: <span id="score">0</span> / 1000
            <span id="music-toggle">[Music: OFF]</span>
        </div>
    </div>

    <div id="cannon" onclick="fireCannon()">⚡ DEPLOY</div>

    <script>
        const canvas = document.getElementById('orbital-canvas');
        const overlay = document.getElementById('transition-overlay');
        const transText = document.getElementById('trans-text');
        const musicToggle = document.getElementById('music-toggle');
        const ytPlayer = document.getElementById('yt-audio');
        
        let cells = [], enemies = [];
        let score = 0, level = 1, isWarping = false;
        const MARGIN = 4;
        let musicStarted = false;
        let musicMuted = true;

        // Progressive generation count
        function getGenCount() {
            if (level === 1) return 1;
            if (level === 2) return 2;
            return 3 * Math.pow(2, level - 3);
        }

        class Entity {
            constructor(x, y, type) {
                this.type = type; this.x = x; this.y = y;
                this.radius = 22; this.health = 100;
                this.el = document.createElement('div');
                this.el.className = `cell-orb cell-${type}`;
                this.el.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div>`;
                this.hpFill = this.el.querySelector('.hp-fill');
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = type === 'cell' ? -6 : (1.8 + level * 0.4); // Slightly slower ramp-up
                canvas.appendChild(this.el);
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if (this.x < this.radius + MARGIN || this.x > window.innerWidth - this.radius - MARGIN) this.vx *= -1;
                if (this.y < this.radius + MARGIN || this.y > window.innerHeight - this.radius - MARGIN) this.vy *= -1;
                this.el.style.transform = `translate(${this.x - this.radius}px, ${this.y - this.radius}px)`;
            }
            takeDamage(dmg) {
                this.health -= dmg;
                this.hpFill.style.width = Math.max(0, this.health) + '%';
                return this.health <= 0;
            }
        }

        function fireCannon() {
            if (isWarping) return;
            // Start music on first cannon fire (user interaction)
            if (!musicStarted) {
                ytPlayer.src = ytPlayer.src.replace('&mute=1', '&mute=0'); // Unmute
                musicStarted = true;
                musicMuted = false;
                musicToggle.textContent = '[Music: ON]';
            }
            const count = getGenCount();
            for(let i=0; i<count; i++) {
                setTimeout(() => {
                    cells.push(new Entity(window.innerWidth/2, window.innerHeight - 100, 'cell'));
                }, i * 60);
            }
        }

        // Fairer enemy spawning: probability scales with level, but smoothed + random delay
        setInterval(() => {
            if (isWarping) return;
            // Base chance 3-4% → up to ~18-20% at high levels, but not instant swarm
            const spawnChance = 0.03 + (level * 0.008); 
            if (Math.random() < spawnChance) {
                const offsetX = (Math.random() - 0.5) * 200; // Spread spawn horizontally
                const type = Math.random() > 0.5 ? 'virus' : 'disease';
                enemies.push(new Entity(window.innerWidth/2 + offsetX, 40 + Math.random()*40, type));
            }
        }, 800 + Math.random() * 400); // Variable interval ~800-1200ms

        async function nextLevel() {
            isWarping = true;
            overlay.classList.add('active');
            
            if (level >= 100) {
                transText.innerHTML = "OLYMPUS ASCENDED!<br><a href='https://georgia-aquarium.vercel.app/#' style='color:var(--cyan)'>CLAIM YOUR HOODIE</a>";
                return; 
            }

            // TRIGGER ADS HERE
            console.log("Calling Ad Zone 206119...");

            await new Promise(r => setTimeout(r, 6000));
            
            level++;
            score = 0;
            cells.forEach(c => c.el.remove());
            enemies.forEach(e => e.el.remove());
            cells = []; enemies = [];
            
            document.getElementById('level').textContent = level;
            document.getElementById('score').textContent = "0";
            transText.textContent = `WARPING TO LEVEL ${level}`;
            isWarping = false;
            overlay.classList.remove('active');
        }

        // Music toggle
        musicToggle.addEventListener('click', () => {
            if (musicMuted) {
                ytPlayer.src = ytPlayer.src.replace('&mute=1', '&mute=0').replace('&mute=0', '&mute=0'); // ensure unmuted
                musicMuted = false;
                musicToggle.textContent = '[Music: ON]';
            } else {
                ytPlayer.src = ytPlayer.src.replace('&mute=0', '&mute=1');
                musicMuted = true;
                musicToggle.textContent = '[Music: OFF]';
            }
        });

        function gameLoop() {
            if (!isWarping) {
                cells.forEach((c, ci) => {
                    c.update();
                    enemies.forEach((e, ei) => {
                        if (Math.hypot(c.x-e.x, c.y-e.y) < 44) {
                            if (e.takeDamage(5)) {
                                e.el.remove(); enemies.splice(ei, 1);
                                score += 20;
                                document.getElementById('score').textContent = score;
                                if (score >= 1000) nextLevel();
                            }
                            if (c.takeDamage(5)) { 
                                c.el.remove(); cells.splice(ci, 1); 
                            }
                        }
                    });
                });
                enemies.forEach(e => e.update());
            }
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

        // Optional: Start music muted on any first click (fallback)
        document.body.addEventListener('click', () => {
            if (!musicStarted) {
                ytPlayer.src = ytPlayer.src.replace('&mute=1', '&mute=0');
                musicStarted = true;
                musicMuted = false;
                musicToggle.textContent = '[Music: ON]';
            }
        }, { once: true });
    </script>
</body>
</html>
